// @bun
import j from"fs-extra";import q from"path";var A={cyan:(...$)=>`\x1B[36m${$.join(" ")}\x1B[0m`,red:(...$)=>`\x1B[31m${$.join(" ")}\x1B[0m`,yellow:(...$)=>`\x1B[33m${$.join(" ")}\x1B[0m`,green:(...$)=>`\x1B[32m${$.join(" ")}\x1B[0m`,blue:(...$)=>`\x1B[34m${$.join(" ")}\x1B[0m`,magenta:(...$)=>`\x1B[35m${$.join(" ")}\x1B[0m`,cyanBright:(...$)=>`\x1B[96m${$.join(" ")}\x1B[0m`,redBright:(...$)=>`\x1B[91m${$.join(" ")}\x1B[0m`,yellowBright:(...$)=>`\x1B[93m${$.join(" ")}\x1B[0m`,greenBright:(...$)=>`\x1B[92m${$.join(" ")}\x1B[0m`,blueBright:(...$)=>`\x1B[94m${$.join(" ")}\x1B[0m`,magentaBright:(...$)=>`\x1B[95m${$.join(" ")}\x1B[0m`,whiteBright:(...$)=>`\x1B[97m${$.join(" ")}\x1B[0m`,gray:(...$)=>`\x1B[90m${$.join(" ")}\x1B[0m`,grey:(...$)=>`\x1B[90m${$.join(" ")}\x1B[0m`,white:(...$)=>`\x1B[37m${$.join(" ")}\x1B[0m`,black:(...$)=>`\x1B[30m${$.join(" ")}\x1B[0m`,blackBright:(...$)=>`\x1B[90m${$.join(" ")}\x1B[0m`,bgCyan:(...$)=>`\x1B[46m${$.join(" ")}\x1B[0m`,bgRed:(...$)=>`\x1B[41m${$.join(" ")}\x1B[0m`,bgYellow:(...$)=>`\x1B[43m${$.join(" ")}\x1B[0m`,bgGreen:(...$)=>`\x1B[42m${$.join(" ")}\x1B[0m`,bgBlue:(...$)=>`\x1B[44m${$.join(" ")}\x1B[0m`,bgMagenta:(...$)=>`\x1B[45m${$.join(" ")}\x1B[0m`,bgCyanBright:(...$)=>`\x1B[106m${$.join(" ")}\x1B[0m`,bgRedBright:(...$)=>`\x1B[101m${$.join(" ")}\x1B[0m`,bgYellowBright:(...$)=>`\x1B[103m${$.join(" ")}\x1B[0m`,bgGreenBright:(...$)=>`\x1B[102m${$.join(" ")}\x1B[0m`,bgBlueBright:(...$)=>`\x1B[104m${$.join(" ")}\x1B[0m`,bgMagentaBright:(...$)=>`\x1B[105m${$.join(" ")}\x1B[0m`,cyanBrightBold:(...$)=>`\x1B[96m\x1B[1m${$.join(" ")}\x1B[0m`,redBrightBold:(...$)=>`\x1B[91m\x1B[1m${$.join(" ")}\x1B[0m`,yellowBrightBold:(...$)=>`\x1B[93m\x1B[1m${$.join(" ")}\x1B[0m`,greenBrightBold:(...$)=>`\x1B[92m\x1B[1m${$.join(" ")}\x1B[0m`,blueBrightBold:(...$)=>`\x1B[94m\x1B[1m${$.join(" ")}\x1B[0m`,magentaBrightBold:(...$)=>`\x1B[95m\x1B[1m${$.join(" ")}\x1B[0m`,whiteBrightBold:(...$)=>`\x1B[97m\x1B[1m${$.join(" ")}\x1B[0m`,grayBrightBold:(...$)=>`\x1B[90m\x1B[1m${$.join(" ")}\x1B[0m`,greyBrightBold:(...$)=>`\x1B[90m\x1B[1m${$.join(" ")}\x1B[0m`,whiteBold:(...$)=>`\x1B[37m\x1B[1m${$.join(" ")}\x1B[0m`,blackBold:(...$)=>`\x1B[30m\x1B[1m${$.join(" ")}\x1B[0m`,blackBrightBold:(...$)=>`\x1B[90m\x1B[1m${$.join(" ")}\x1B[0m`};import H from"fs";import I from"path";function J($){return{name:"vite-devops-string-replace-plugin",enforce:"pre",load(C){const B=I.resolve(C),z=[".ts",".js",".tsx",".jsx"];if(H.existsSync(B)&&z.includes(I.extname(B))&&!B.includes("node_modules")&&!B.includes("\0")){let w=H.readFileSync(B,{encoding:"utf-8"});return $.forEach((E)=>{w=w.replace(E.from,E.to)}),w}}}}function Z($){const C=process.env.PROJECT_ROOT||".",B=q.resolve(C,"app/config");if(!j.existsSync(B)){console.warn(`viteDevopsAppConfigPlugin: ${A.cyanBrightBold("No app/config folder found.")}`);return}try{const z=j.readdirSync(B).filter((b)=>{return j.statSync(q.join(B,b)).isDirectory()}),w=z.map((b)=>q.join(B,b)),K=z.map((b,y)=>{if(!$)if(j.existsSync(q.join(w[y],`${b}.local`))||j.existsSync(q.join(w[y],`${b}.local.js`))||j.existsSync(q.join(w[y],`${b}.local.ts`))||j.existsSync(q.join(w[y],`${b}.local.tsx`))||j.existsSync(q.join(w[y],`${b}.local.jsx`)))return[{from:`"config/${b}/${b}"`,to:`"config/${b}/${b}.local"`},{from:`"config/${b}/${b}.js"`,to:`"config/${b}/${b}.local.js"`},{from:`"config/${b}/${b}.ts"`,to:`"config/${b}/${b}.local.ts"`}];else return[];return[{from:`"config/${b}/${b}"`,to:`"config/${b}/${b}.${$}"`},{from:`"config/${b}/${b}.js"`,to:`"config/${b}/${b}.${$}.js"`},{from:`"config/${b}/${b}.ts"`,to:`"config/${b}/${b}.${$}.ts"`}]}).reduce((b,y)=>b.concat(y),[]),G=[...!$&&(j.existsSync(q.join(B,"env.local"))||j.existsSync(q.join(B,"env.local.js"))||j.existsSync(q.join(B,"env.local.ts"))||j.existsSync(q.join(B,"env.local.tsx"))||j.existsSync(q.join(B,"env.local.jsx")))?[{from:'"config/env"',to:'"config/env.local"'},{from:'"config/env.js"',to:'"config/env.local.js"'},{from:'"config/env.ts"',to:'"config/env.local.ts"'}]:$?[{from:'"config/env"',to:`"config/env.${$}"`},{from:'"config/env.js"',to:`"config/env.${$}.js"`},{from:'"config/env.ts"',to:`"config/env.${$}.ts"`}]:[],...K];if(G.length>0)console.warn(`

  ${A.yellowBrightBold("Using the following mappings for app config:")}

  \t${A.cyanBrightBold(G.map((b)=>`\n  ${b.from} => ${b.to}`).join("\n\t"))}

      `);return J(G)}catch(z){console.error(z),console.error(A.redBrightBold(`
      App config plugin failed to load. The default config paths will be used
      and any specific environment requested will be ignored.
    `))}}export{Z as viteDevopsAppConfigPlugin};
